<!-- Copie o conteúdo de sala-cest/index.html e ajuste para Sala Auditório -->
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Chave do App Check (opcional). Preencha para habilitar proteção. -->
    <meta name="app-check-site-key" content="" />
    <title>Reserva da Sala de Reunião</title>
    <!-- Favicon removido para evitar erro 404 -->
    <link rel="stylesheet" href="../style.css" />
    <link
      rel="shortcut icon"
      href="../public/favicon.ico"
      type="image/x-icon"
    />
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <!-- Botão de voltar para o início -->
    <nav class="nav-voltar-inicio">
      <a href="/index.html" class="btn-voltar-inicio">
        <i data-lucide="arrow-left" class="icon-voltar"></i> Início
      </a>
    </nav>
    <!-- Loader visual institucional -->
    <div
      id="pageLoader"
      style="
        position: fixed;
        inset: 0;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(20, 24, 38, 0.92);
        transition: opacity 0.3s;
      "
    >
      <div style="display: flex; flex-direction: column; align-items: center">
        <div style="margin-bottom: 1.2em">
          <img
            src="../public/LogoPGE_Horizontal-Branca--2048x948.png"
            alt="Logo PGE"
            style="
              max-width: 180px;
              width: 80%;
              filter: drop-shadow(0 2px 12px #2228);
              margin-bottom: 0.7em;
            "
          />
        </div>
        <div
          class="loader-spinner"
            style="font-size: 1rem; font-weight: 600; color: #fff; margin-right: 8px;"
            width: 54px;
            height: 54px;
            border: 6px solid #fff;
            border-top: 6px solid #667eea;
            border-radius: 50%;
            animation: spin 1.1s linear infinite;
            margin-bottom: 1.2em;
          "
        ></div>
        <div
          style="
            color: #fff;
            font-size: 1.18rem;
            font-weight: 500;
            letter-spacing: 0.5px;
          "
        >
          Carregando...
        </div>
      </div>
    </div>
    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @media (max-width: 600px) {
        #pageLoader img {
          max-width: 120px;
        }
        #pageLoader .loader-spinner {
          width: 38px;
          height: 38px;
          border-width: 4px;
        }
        #pageLoader div[style*="font-size:1.18rem"] {
          font-size: 1rem;
        }
      }
    </style>
    <div class="container">
      <!-- Header com logos -->
      <div class="logos-header">
        <img
          src="../public/LogoPGE_Horizontal-Branca--2048x948.png"
          alt="Logo 1"
          class="logo-img logo-1"
        />
        <img
          src="../public/eppe-logo-color-branco.png"
          alt="Logo 2"
          class="logo-img logo-2"
        />
      </div>

      <!-- Sala Auditório: interface fixa para esta sala -->

      <!-- Header principal -->
      <header>
        <div class="header-content">
          <h1>
            <i data-lucide="landmark" style="margin-right: 6px"></i> Sala
            Auditório
          </h1>
          <div class="sala-info">
            <div class="info-item">
              <i data-lucide="map-pin" class="info-icon"></i>
              <span>Localização: Prédio Sede - Térreo</span>
            </div>
            <div class="info-item">
              <i data-lucide="users" class="info-icon"></i>
              <span>Capacidade: 80 pessoas</span>
            </div>
          </div>
          <div class="estrutura-info">
            <h3>Estrutura Disponível:</h3>
            <div class="estrutura-grid">
              <div class="estrutura-item">
                <i data-lucide="mic" style="margin-right: 4px"></i> Microfone
              </div>
              <div class="estrutura-item">
                <i data-lucide="volume-2" style="margin-right: 4px"></i> Caixa
                de Som
              </div>
              <div class="estrutura-item">
                <i data-lucide="projector" style="margin-right: 4px"></i>
                Projetor
              </div>
              <div class="estrutura-item">
                <i data-lucide="snowflake" style="margin-right: 4px"></i> Ar
                Condicionado
              </div>
              <div class="estrutura-item">
                <div
                  class="estrutura-item"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <svg
                    width="22"
                    height="22"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    style="
                      margin-right: 4px;
                      min-width: 22px;
                      min-height: 22px;
                      vertical-align: middle;
                    "
                  >
                    <rect x="7" y="10" width="10" height="5" rx="2" />
                    <rect x="9" y="3" width="6" height="7" rx="2" />
                    <line x1="7" y1="15" x2="7" y2="21" />
                    <line x1="17" y1="15" x2="17" y2="21" />
                  </svg>
                  Cadeiras
                </div>
              </div>
              <div class="estrutura-item">
                <i data-lucide="monitor" style="margin-right: 4px"></i>
                Computador
              </div>
            </div>
            <div class="aviso-notebook">
              <i data-lucide="laptop" class="aviso-icon"></i>
              <span
                ><strong>Importante:</strong> Levar apresentação em pendrive ou
                notebook</span
              >
            </div>
          </div>
        </div>
      </header>

      <!-- Status Atual da Sala -->
      <div class="status-atual" id="statusSala">
        <div class="status-icon">
          <i
            data-lucide="circle"
            color="#28a745"
            style="width: 1.2em; height: 1.2em"
          ></i>
        </div>
        <h2>Conectando...</h2>
        <p>Carregando dados do sistema...</p>
      </div>

      <div class="main-grid">
        <!-- Consulta Rápida -->
        <div class="card">
          <h2>
            <i data-lucide="search" style="margin-right: 4px"></i> Consultar
            Disponibilidade
          </h2>

          <!-- Calendário Mensal (visual) -->
          <div class="calendar" id="calendar">
            <div class="calendar-header">
              <button
                type="button"
                class="cal-nav"
                id="calPrev"
                aria-label="Mês anterior"
              >
                ◀
              </button>
              <div class="calendar-title" id="calTitle">Mês Ano</div>
              <button
                type="button"
                class="cal-nav"
                id="calNext"
                aria-label="Próximo mês"
              >
                ▶
              </button>
            </div>
            <div class="calendar-weekdays">
              <div>Dom</div>
              <div>Seg</div>
              <div>Ter</div>
              <div>Qua</div>
              <div>Qui</div>
              <div>Sex</div>
              <div>Sáb</div>
            </div>
            <div class="calendar-grid" id="calGrid">
              <!-- Dias são renderizados via JS -->
            </div>
            <div class="calendar-legend">
              <span class="legend-item"
                ><span class="legend-dot has"></span> tem reunião</span
              >
              <span class="legend-item"
                ><span class="legend-dot today"></span> hoje</span
              >
              <span class="legend-item"
                ><span class="legend-dot selected"></span> selecionado</span
              >
              <span class="legend-item"
                ><span class="legend-dot other"></span> outro mês</span
              >
            </div>
          </div>
          <!-- Consulta baseada apenas no calendário: clique em um dia para ver as reservas -->
          <div id="resultadoConsulta"></div>
        </div>

        <!-- Formulário de Nova Reserva -->
        <div class="card" id="cardNovaReserva" style="display: none">
          <h2>
            <i data-lucide="calendar-plus" style="margin-right: 4px"></i> Nova
            Reserva
          </h2>
          <!-- Área para exibir o email do usuário autenticado -->
          <div
            class="user-auth"
            style="display: flex; align-items: center; margin-bottom: 1rem"
          >
            <div
              id="userGreeting"
              class="user-greeting"
            ></div>
            <div id="logoutContainer"></div>
          </div>
          <form id="reservaForm">
            <!-- Campo "responsavel" oculto, preenchido automaticamente -->
            <input type="hidden" id="responsavel" />
            <div class="form-group">
              <label for="data">Data da Reunião:</label>
              <small class="input-hint"
                >Clique no campo para selecionar a data desejada</small
              >
              <input type="date" id="data" required />
            </div>

            <div class="form-group">
              <span class="form-label-group">Horário:</span>
              <div class="time-inputs">
                <div>
                  <label for="horaInicio">Início:</label>
                  <input type="time" id="horaInicio" required />
                </div>
                <div>
                  <label for="horaFim">Fim:</label>
                  <input type="time" id="horaFim" required />
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="assunto">Assunto da Reunião:</label>
              <input
                type="text"
                id="assunto"
                required
                placeholder="Ex: Reunião de planejamento"
              />
            </div>

            <div class="form-group">
              <label for="observacoes">Observações (opcional):</label>
              <textarea
                id="observacoes"
                rows="3"
                placeholder="Informações adicionais..."
              ></textarea>
            </div>

            <button type="submit" id="btnReservar">✅ Reservar Sala</button>
          </form>
        </div>

        <!-- Mensagem para usuários não autorizados (fora do formulário) -->
        <div
          class="card"
          id="cardMensagemNaoAutorizado"
          style="display: none; margin-bottom: 1.5em"
        >
          <h2 style="margin-bottom: 0.7em">
            <i data-lucide="calendar-plus" style="margin-right: 4px"></i> Nova
            Reserva
          </h2>
          <div style="padding: 1em; font-size: 1.05em">
            <strong
              >Nesta sala, apenas pessoas autorizadas podem fazer
              reservas.</strong
            ><br /><br />
            Para solicitar agendamento, entre em contato com o setor
            responsável:<br />
            <span style="display: block; margin-top: 8px">
              <b>Email:</b> eppe@pge.sc.gov.br<br />
              <b>Telefone:</b> (48) 3664-5938
            </span>
          </div>
        </div>
      </div>

      <!-- Agenda de Reservas -->
      <div class="agenda-card">
        <div class="agenda-header">
          <h2>
            <i data-lucide="list" style="margin-right: 4px"></i> Próximas
            Reservas
          </h2>
          <span class="contador-reservas" id="contadorReservas"
            >0 reservas</span
          >
        </div>
        <div id="listaReservas">
          <div class="no-reservas">Carregando reservas...</div>
        </div>
      </div>
    </div>

    <!-- Footer com informações de contato -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>
            <i data-lucide="help-circle" style="margin-right: 4px"></i> Suporte
            Técnico
          </h3>
          <div class="contact-info">
            <div class="contact-item">
              <i data-lucide="mail" class="contact-icon"></i>
              <span>Email: eppe@pge.sc.gov.br</span>
            </div>
            <div class="contact-item">
              <i data-lucide="phone" class="contact-icon"></i>
              <span>Telefone: (48) 3664-5938</span>
            </div>
          </div>
        </div>

        <div class="footer-section">
          <h3>
            <i data-lucide="info" style="margin-right: 4px"></i> Informações
          </h3>
          <div class="info-list">
            <p>
              Cancelamento: <strong>apenas pelo responsável autenticado</strong>
            </p>
            <p>Em caso de problemas, entre em contato com o suporte</p>
          </div>
        </div>

        <div class="footer-section">
          <h3><i data-lucide="building" style="margin-right: 4px"></i> EPPE</h3>
          <div class="institution-info">
            <p>© 2025 - Sistema de Reservas</p>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>
          Desenvolvido para facilitar o agendamento da sala de reuniões | Versão
          1.0
        </p>
      </div>
    </footer>

    <!-- Script de interface compartilhada -->
    <script src="../interface-sala.js"></script>
    <!-- Script principal de reservas -->
    <script type="module" src="firebase-script.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        if (window.lucide) lucide.createIcons();
      });
    </script>
    <script>
      // Exibe o formulário de nova reserva apenas para o e-mail autorizado
      // e mostra mensagem para não autorizados
      window.toggleNovaReserva = function (email) {
        const card = document.getElementById("cardNovaReserva");
        const msg = document.getElementById("cardMensagemNaoAutorizado");
        const emailAutorizado = "cristianmartinez@pge.sc.gov.br";
        if (!card || !msg) return;
        if (email && email.toLowerCase() === emailAutorizado) {
          card.style.display = "";
          msg.style.display = "none";
        } else if (email) {
          card.style.display = "none";
          msg.style.display = "";
        } else {
          card.style.display = "none";
          msg.style.display = "none";
        }
      };
    </script>

    <script>
      // Esconde o loader quando a página estiver pronta (autenticação e dados principais carregados)
      function hidePageLoader() {
        const loader = document.getElementById("pageLoader");
        if (loader) {
          loader.style.opacity = "0";
          setTimeout(() => (loader.style.display = "none"), 350);
        }
      }
      // Exemplo de integração: chame hidePageLoader() após autenticação e dados carregados
      // Se já houver lógica JS, basta chamar hidePageLoader() no ponto certo (ex: monitorAuthState, após atualizar interface)
      window.hidePageLoader = hidePageLoader;
    </script>
  </body>
</html>
