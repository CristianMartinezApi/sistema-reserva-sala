<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Chave do App Check (opcional). Preencha para habilitar proteÃ§Ã£o. -->
    <meta name="app-check-site-key" content="" />
    <title>Reserva da Sala de ReuniÃ£o</title>
    <link rel="shortcut icon" href="icon.ico.png" type="image/x-icon" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Loader visual institucional -->
    <div
      id="pageLoader"
      style="
        position: fixed;
        inset: 0;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(20, 24, 38, 0.92);
        transition: opacity 0.3s;
      "
    >
      <div style="display: flex; flex-direction: column; align-items: center">
        <div style="margin-bottom: 1.2em">
          <img
            src="../LogoPGE_Horizontal-Branca--2048x948.png"
            alt="Logo PGE"
            style="
              max-width: 180px;
              width: 80%;
              filter: drop-shadow(0 2px 12px #2228);
              margin-bottom: 0.7em;
            "
          />
        </div>
        <div
          class="loader-spinner"
          style="
            width: 54px;
            height: 54px;
            border: 6px solid #fff;
            border-top: 6px solid #667eea;
            border-radius: 50%;
            animation: spin 1.1s linear infinite;
            margin-bottom: 1.2em;
          "
        ></div>
        <div
          style="
            color: #fff;
            font-size: 1.18rem;
            font-weight: 500;
            letter-spacing: 0.5px;
          "
        >
          Carregando...
        </div>
      </div>
    </div>
    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @media (max-width: 600px) {
        #pageLoader img {
          max-width: 120px;
        }
        #pageLoader .loader-spinner {
          width: 38px;
          height: 38px;
          border-width: 4px;
        }
        #pageLoader div[style*="font-size:1.18rem"] {
          font-size: 1rem;
        }
      }
    </style>
    <div class="container">
      <!-- Header com logos -->
      <div class="logos-header">
        <img
          src="LogoPGE_Horizontal-Branca--2048x948.png"
          alt="Logo 1"
          class="logo-img logo-1"
        />
        <img
          src="eppe-logo-color-branco.png"
          alt="Logo 2"
          class="logo-img logo-2"
        />
      </div>
      <!-- Sala CEST: seletor removido, interface fixa para esta sala -->
      <!-- Header principal -->
      <header>
        <div class="header-content">
          <h1>ğŸ¢ Sala de ReuniÃµes CEST/EPPE</h1>
          <div class="sala-info">
            <div class="info-item">
              <span class="info-icon">ğŸ“</span>
              <span>LocalizaÃ§Ã£o: PrÃ©dio Sede - 1Âº Andar</span>
            </div>
            <div class="info-item">
              <span class="info-icon">ğŸ‘¥</span>
              <span>Capacidade: 9 pessoas</span>
            </div>
          </div>
          <div class="estrutura-info">
            <h3>Estrutura DisponÃ­vel:</h3>
            <div class="estrutura-grid">
              <div class="estrutura-item">ğŸ“º TV</div>
              <div class="estrutura-item">ğŸ”Œ Cabo HDMI</div>
              <div class="estrutura-item">â„ï¸ Ar Condicionado</div>
              <div class="estrutura-item">âš¡ Guia ElÃ©trico</div>
            </div>
            <div class="aviso-notebook">
              <span class="aviso-icon">ğŸ’»</span>
              <span><strong>Importante:</strong> Precisa trazer notebook</span>
            </div>
          </div>
        </div>
      </header>
      <!-- Status Atual da Sala -->
      <div class="status-atual" id="statusAtual">
        <div class="status-icon">ğŸŸ¢</div>
        <h2>Conectando...</h2>
        <p>Carregando dados do sistema...</p>
      </div>
      <div class="main-grid">
        <!-- Consulta RÃ¡pida -->
        <div class="card">
          <h2>ğŸ” Consultar Disponibilidade</h2>
          <!-- CalendÃ¡rio Mensal (visual) -->
          <div class="calendar" id="calendar">
            <div class="calendar-header">
              <button
                type="button"
                class="cal-nav"
                id="calPrev"
                aria-label="MÃªs anterior"
              >
                â—€
              </button>
              <div class="calendar-title" id="calTitle">MÃªs Ano</div>
              <button
                type="button"
                class="cal-nav"
                id="calNext"
                aria-label="PrÃ³ximo mÃªs"
              >
                â–¶
              </button>
            </div>
            <div class="calendar-weekdays">
              <div>Dom</div>
              <div>Seg</div>
              <div>Ter</div>
              <div>Qua</div>
              <div>Qui</div>
              <div>Sex</div>
              <div>SÃ¡b</div>
            </div>
            <div class="calendar-grid" id="calGrid">
              <!-- Dias sÃ£o renderizados via JS -->
            </div>
            <div class="calendar-legend">
              <span class="legend-item"
                ><span class="legend-dot has"></span> tem reuniÃ£o</span
              >
              <span class="legend-item"
                ><span class="legend-dot today"></span> hoje</span
              >
              <span class="legend-item"
                ><span class="legend-dot selected"></span> selecionado</span
              >
              <span class="legend-item"
                ><span class="legend-dot other"></span> outro mÃªs</span
              >
            </div>
          </div>
          <!-- Consulta baseada apenas no calendÃ¡rio: clique em um dia para ver as reservas -->
          <div id="resultadoConsulta"></div>
        </div>
        <!-- FormulÃ¡rio de Nova Reserva -->
        <div class="card">
          <h2>ğŸ“… Nova Reserva</h2>
          <!-- Ãrea para exibir o email do usuÃ¡rio autenticado -->
          <div
            class="user-auth"
            style="display: flex; align-items: center; margin-bottom: 1rem"
          >
            <div
              id="userGreeting"
              class="user-greeting"
              style="font-size: 0.9rem"
            ></div>
            <div id="logoutContainer"></div>
          </div>
          <form id="reservaForm">
            <!-- Campo "responsavel" oculto, preenchido automaticamente -->
            <input type="hidden" id="responsavel" />
            <div class="form-group">
              <label for="data">Data da ReuniÃ£o:</label>
              <small class="input-hint"
                >Clique no campo para selecionar a data desejada</small
              >
              <input type="date" id="data" required />
            </div>
            <div class="form-group">
              <label>HorÃ¡rio:</label>
              <div class="time-inputs">
                <div>
                  <label for="horaInicio">InÃ­cio:</label>
                  <input type="time" id="horaInicio" required />
                </div>
                <div>
                  <label for="horaFim">Fim:</label>
                  <input type="time" id="horaFim" required />
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="assunto">Assunto da ReuniÃ£o:</label>
              <input
                type="text"
                id="assunto"
                required
                placeholder="Ex: ReuniÃ£o de planejamento"
              />
            </div>
            <div class="form-group">
              <label for="observacoes">ObservaÃ§Ãµes (opcional):</label>
              <textarea
                id="observacoes"
                rows="3"
                placeholder="InformaÃ§Ãµes adicionais..."
              ></textarea>
            </div>
            <button type="submit" id="btnReservar">âœ… Reservar Sala</button>
          </form>
        </div>
      </div>
      <!-- Agenda de Reservas -->
      <div class="agenda-card">
        <div class="agenda-header">
          <h2>ğŸ“‹ PrÃ³ximas Reservas</h2>
          <span class="contador-reservas" id="contadorReservas"
            >0 reservas</span
          >
        </div>
        <div id="listaReservas">
          <div class="no-reservas">Carregando reservas...</div>
        </div>
      </div>
    </div>
    <!-- Footer com informaÃ§Ãµes de contato -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ğŸ“ Suporte TÃ©cnico</h3>
          <div class="contact-info">
            <div class="contact-item">
              <span class="contact-icon">ğŸ“§</span>
              <span>Email: eppe@pge.sc.gov.br</span>
            </div>
            <div class="contact-item">
              <span class="contact-icon">ğŸ“±</span>
              <span>Telefone: (48) 3664-5938</span>
            </div>
          </div>
        </div>
        <div class="footer-section">
          <h3>â„¹ï¸ InformaÃ§Ãµes</h3>
          <div class="info-list">
            <p>
              Cancelamento: <strong>apenas pelo responsÃ¡vel autenticado</strong>
            </p>
            <p>Em caso de problemas, entre em contato com o suporte</p>
          </div>
        </div>
        <div class="footer-section">
          <h3>ğŸ¢ EPPE</h3>
          <div class="institution-info">
            <p>Â© 2025 - Sistema de Reservas</p>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>
          Desenvolvido para facilitar o agendamento da sala de reuniÃµes | VersÃ£o
          1.0
        </p>
      </div>
    </footer>
    <!-- APENAS ESTE SCRIPT -->
    <script type="module" src="firebase-script-cest.js"></script>
  </body>
</html>
